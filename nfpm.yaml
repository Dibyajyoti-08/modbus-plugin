# yaml-language-server: $schema=https://nfpm.goreleaser.com/static/schema.json
---
# nfpm configuration file
#
# check https://nfpm.goreleaser.com/configuration for detailed usage
#
name: "tedge-modbus-plugin"
arch: "all"
platform: "linux"
version: ${VERSION}
section: "default"
priority: "extra"
maintainer: techforum.softwareag.com
description: "Modbus plugin for the thin-edge.io"
homepage: "https://github.com/thin-edge/modbus-plugin"
license: "Apache-2.0"

contents:
#modbus reader files
- src: ./modbus_reader
  dst: /usr/lib/python3/dist-packages/modbus_reader/

  #c8y_ModbusConfiguration
- src: ./operations/c8y_ModbusConfiguration/c8y_ModbusConfiguration
  dst: /etc/tedge/operations/c8y/c8y_ModbusConfiguration
  file_info:
      mode: 0644
- src: ./operations/c8y_ModbusConfiguration/c8y_ModbusConfiguration.py
  dst: /etc/tedge/plugins/modbus/c8y_ModbusConfiguration.py
  file_info:
      mode: 0755

# c8y_ModbusDevice
- src: ./operations/c8y_ModbusDevice/c8y_ModbusDevice
  dst: /etc/tedge/operations/c8y/c8y_ModbusDevice
  file_info:
      mode: 0644
- src: ./operations/c8y_ModbusDevice/c8y_ModbusDevice.py
  dst: /etc/tedge/plugins/modbus/c8y_ModbusDevice.py
  file_info:
      mode: 0755
  # Empty modbus config
# - dst: /etc/tedge/plugins/modbus/modbus.toml
#   type: config
#   # Empty device config
# - dst: /etc/tedge/plugins/modbus/devices.toml
#   type: config
# System D Unit File
- src: ./tedge-modbus-plugin.service
  dst: /lib/systemd/system/tedge-modbus-plugin.service
  file_info:
      mode: 0644
      owner: root

  # Logfile folder
- dst: /var/log/tedge-modbus-plugin
  type: dir

overrides:
  deb:
    depends:
      - python (>= 3.8.0) | python3 (>= 3.8.0)
      - python3-paho-mqtt
      - python3-pymodbus
      - python3-watchdog
      - python3-serial-asyncio
      - python3-tomli
      - python3-toml
      - python3-requests
    scripts:
      postinstall: ./scripts/deb/postinst
      preremove: ./scripts/deb/prerm
      postremove: ./scripts/deb/postrm
  rpm:
    depends:
      - python3
      - python3-paho-mqtt
      - python3-pymodbus
      - python3-watchdog
      - python3-serial-asyncio
      - python3-tomli
      - python3-toml
      - python3-requests
    scripts:
      postinstall: ./scripts/rpm/postinst
      preremove: ./scripts/rpm/prerm
      postremove: ./scripts/rpm/postrm
